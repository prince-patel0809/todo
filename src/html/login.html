<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Taskify</title>
    <script src="/static/tailwind.js"></script>
</head>

<!-- ... existing head unchanged ... -->

<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white shadow-md rounded-lg w-full max-w-md p-8">
        <h2 class="text-2xl font-bold text-center text-indigo-600 mb-6">Login to Taskify</h2>

        <form id="loginForm" class="space-y-4">
            <div>
                <label class="block text-gray-700 mb-1" for="email">Email</label>
                <input id="email" name="email" type="email" placeholder="you@example.com" required
                    class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none">
            </div>

            <div>
                <label class="block text-gray-700 mb-1" for="password">Password</label>
                <input id="password" name="password" type="password" placeholder="••••••••" required
                    class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none">
            </div>

            <button id="loginBtn" type="submit"
                class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                <span id="btnText">Login</span>
                <svg id="spinner" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
            </button>
        </form>

        <!-- Message Box -->
        <div id="messageBox" class="mt-6 hidden px-4 py-3 rounded-md text-sm text-center"></div>
    </div>

    <script>
        const loginForm = document.getElementById('loginForm');
        const messageBox = document.getElementById('messageBox');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const spinner = document.getElementById('spinner');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            messageBox.classList.add('hidden');
            messageBox.textContent = '';
            messageBox.className = 'mt-6 hidden px-4 py-3 rounded-md text-sm text-center';

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!validateEmail(email)) {
                showMessage('Please enter a valid email.', 'error');
                return;
            }
            if (password.length < 1) {
                showMessage('Password must be at least 6 characters.', 'error');
                return;
            }

            setLoading(true);

            try {
                // 
                const res = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();
                if (!res.ok) {
                    showMessage(data.error || 'Login failed. Please try again.', 'error');
                } else {
                    showMessage(data.message || 'Login successful!', 'success');
                    // save cookies and redirect to home page
                    const date = new Date();
                    date.setTime(date.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days in ms
                    const expires = date.toUTCString();
                    document.cookie = `token=${data.result.token}; expires=${expires}; path=/; secure; SameSite=Strict`;
                    document.cookie = `user=${JSON.stringify(data.result.user)}; expires=${expires}; path=/; secure; SameSite=Strict`;
                    window.location.href = '/';
                }
            } catch (err) {
                showMessage('Network error. Please try again later.', 'error');
            } finally {
                setLoading(false);
            }
        });

        function validateEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-700', 'border', 'border-green-300');
            } else {
                messageBox.classList.add('bg-red-100', 'text-red-700', 'border', 'border-red-300');
            }
        }

        function setLoading(isLoading) {
            loginBtn.disabled = isLoading;
            spinner.classList.toggle('hidden', !isLoading);
            btnText.textContent = isLoading ? 'Logging in...' : 'Login';
        }
    </script>

</body>

</html>